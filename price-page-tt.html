<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لیست قیمت هوشمند | آهن چک</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;400;700;900&display=swap');
        :root { 
            --primary-green: #02C671; 
            --dark-green: #012612; 
            --header-bg: #013a1b;
            --bg-soft: #f8fafc; 
        }
        body { font-family: 'Vazirmatn', sans-serif; background-color: var(--bg-soft); color: var(--dark-green); }
        .price-card { background: white; border-radius: 1.5rem; border: 1px solid #e2e8f0; overflow: hidden; margin-bottom: 2rem; }
        .table-header { background-color: var(--header-bg); color: white; }
        .zebra-row:nth-child(even) { background-color: #f1f7f4; }
        .price-tag { color: var(--primary-green); font-weight: 900; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <div class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h1 id="pageTitle" class="text-3xl font-black text-slate-900">در حال بارگذاری...</h1>
                <p id="lastUpdate" class="text-slate-500 mt-2 text-sm italic"></p>
            </div>
            <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="جستجو در لیست..." 
                   class="px-6 py-3 rounded-2xl border border-gray-200 focus:ring-2 focus:ring-[#02C671] outline-none w-full md:w-80 shadow-sm">
        </div>

        <div id="tablesContainer"></div>
    </div>

    <script>
        async function loadDynamicData() {
            try {
                // در اینجا نام فایل را جایگزین کنید (مثلاً تسمه.json)
                const response = await fetch('تسمه.json');
                const data = await response.json();

                // استخراج هدرها و ردیف‌ها به صورت کاملاً داینامیک
                const headers = data.headersss || data.headers || [];
                const rows = data.dataaa || data.rows || [];
                
                document.getElementById('pageTitle').innerText = "لیست قیمت روز";
                document.getElementById('lastUpdate').innerText = "بروزرسانی شده در: " + (data.scraped_attt || data.scraped_at);

                renderTable(headers, rows);
            } catch (error) {
                console.error("خطا در بارگذاری داده‌ها:", error);
            }
        }

        function renderTable(headers, rows) {
            const container = document.getElementById('tablesContainer');
            
            // پیدا کردن کلیدهای داینامیک (مثل col_0, col_1 و ...)
            // این بخش کلیدهایی که با col_ شروع می‌شوند یا حاوی price هستند را پیدا می‌کند
            const rowKeys = Object.keys(rows[0]).filter(key => 
                key.startsWith('col_') || key.includes('price_str') || key === 'price'
            ).sort();

            let html = `
                <div class="price-card shadow-xl border-t-4 border-[#02C671]">
                    <div class="overflow-x-auto">
                        <table class="w-full text-right border-collapse">
                            <thead>
                                <tr class="table-header text-sm md:text-base">
                                    ${headers.map(h => `<th class="px-6 py-5 whitespace-nowrap font-bold">${h}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody id="tableBody">
            `;

            rows.forEach(row => {
                // بررسی اینکه آیا ردیف مربوط به "آخرین بروزرسانی" است یا داده واقعی
                const firstVal = row[rowKeys[0]] || "";
                if (firstVal.includes("آخرین بروز رسانی")) return; // پرش از ردیف‌های اضافی

                html += `<tr class="zebra-row border-b border-gray-50 hover:bg-green-50 transition-colors">`;
                
                rowKeys.forEach((key, index) => {
                    let cellValue = row[key] || "-";
                    const isPrice = key.includes('price');
                    
                    html += `
                        <td class="px-6 py-4 text-sm md:text-base ${isPrice ? 'price-tag text-lg' : 'text-slate-700 font-medium'}">
                            ${cellValue} ${isPrice && cellValue !== "-" ? '<span class="text-[10px] text-gray-400 mr-1">تومان</span>' : ''}
                        </td>`;
                });
                
                html += `</tr>`;
            });

            html += `</tbody></table></div></div>`;
            container.innerHTML = html;
        }

        function filterTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toLowerCase();
            const rows = document.querySelectorAll("#tableBody tr");

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? "" : "none";
            });
        }

        window.onload = loadDynamicData;
    </script>
</body>
</html>
