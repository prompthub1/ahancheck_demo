<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لیست قیمت روز | آهن چک</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/prompthub1/ahancheck_demo/refs/heads/main/assets/favicon.ico">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;400;700;900&display=swap');
        :root { 
            --primary-green: #02C671; 
            --dark-green: #012612; 
            --header-green: #013a1b;
            --bg-soft: #f8fafc; 
            --zebra-green: #f1f7f4; 
        }

        /* اسکرول‌بار عمودی کل صفحه */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
            border: 2px solid #f1f5f9;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-green);
        }

        body { 
            font-family: 'Vazirmatn', sans-serif; 
            background-color: var(--bg-soft); 
            color: var(--dark-green); 
            overflow-x: hidden; 
            scroll-behavior: smooth;
        }

        .glass-card {
            background: #ffffff;
            border: 1px solid #cbd5e1;
            border-radius: 24px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
        }

        .factory-section {
            background: white;
            border-radius: 20px;
            margin-bottom: 2.5rem;
            overflow: hidden;
            border: 1.5px solid #e2e8f0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.04);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        tbody tr:nth-child(even) { background-color: var(--zebra-green); }

        /* اسکرول‌بار افقی بالای جداول */
        .custom-scroll-container {
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-green) #e2e8f0;
        }

        .custom-scroll-container::-webkit-scrollbar {
            height: 8px;
        }
        .custom-scroll-container::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scroll-container::-webkit-scrollbar-thumb {
            background: var(--primary-green);
            border-radius: 10px;
        }

        .main-table-scroll::-webkit-scrollbar {
            display: none;
        }
        .main-table-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
            overflow-x: auto;
        }

        .top-scroll-bar {
            display: none;
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            padding: 4px 0;
        }
        .top-scroll-content {
            height: 1px;
        }

        @media (max-width: 1024px) {
            .top-scroll-bar { display: block; }
        }

        /* تنظیمات سوئیچ */
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { 
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; 
            background-color: #94a3b8; transition: .3s; border-radius: 20px; 
        }
        .slider:before { 
            position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; 
            background-color: white; transition: .3s; border-radius: 50%; 
        }
        input:checked + .slider { background-color: var(--primary-green); }
        input:checked + .slider:before { transform: translateX(20px); }

        .call-btn-container {
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .call-btn-hidden {
            transform: translateY(120px) scale(0.8);
            opacity: 0;
            pointer-events: none;
        }

        th {
            background-color: var(--header-green) !important;
            color: #ffffff !important;
            font-weight: 900;
            border-left: 1px solid rgba(255,255,255,0.1);
        }

        .ltr { direction: ltr; display: inline-block; }
    </style>
</head>
<body class="min-h-screen pb-32 lg:pb-12 text-right">

    <header class="bg-white sticky top-0 z-50 border-b-2 border-gray-100 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 md:px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-6 h-full">
                <a href="index.html" class="block transform transition hover:scale-105">
                    <img src="assets/logo.png" alt="آهن چک" class="h-12 w-auto" onerror="this.src='https://placehold.co/800x300/012612/02C671?text=AhanCheck'">
                </a>
                <h1 id="pageTitle" class="font-black text-lg md:text-2xl text-slate-800 border-r-2 pr-5 border-gray-200 truncate">بارگذاری...</h1>
            </div>
            
            <a href="index.html" class="text-sm font-bold text-slate-500 hover:text-[var(--primary-green)] flex items-center gap-2 transition-all">
                <span class="hidden md:inline">بازگشت</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 md:px-6 py-6 md:py-10">
        
        <!-- نوار ابزار هوشمند -->
        <div class="glass-card p-4 md:p-6 mb-8 md:mb-12">
            <div class="flex flex-col lg:flex-row gap-4 lg:gap-6 items-stretch lg:items-center">
                
                <!-- جستجو (سمت راست در دسکتاپ) -->
                <div class="relative flex-grow order-1 lg:order-2">
                    <input type="text" id="searchInput" onkeyup="filterRows()" 
                           placeholder="جستجوی هوشمند (مثلاً: ۱۴ اصفهان یا ورق ۳ میل)" 
                           class="w-full bg-slate-50 border-2 border-slate-200 rounded-2xl px-12 md:px-14 py-4 md:py-5 focus:ring-4 focus:ring-[var(--primary-green)]/10 focus:border-[var(--primary-green)] outline-none text-base md:text-lg font-bold transition-all text-right">
                    <svg class="w-6 h-6 absolute right-4 md:right-5 top-4 md:top-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="2.5" stroke-linecap="round"/></svg>
                </div>

                <!-- فیلترها (سمت چپ در دسکتاپ) -->
                <div class="flex flex-row items-center gap-2 md:gap-4 order-2 lg:order-1">
                    <!-- سوئیچ ارزش افزوده - متن راست، سوئیچ چپ -->
                    <div class="flex-1 lg:flex-none flex items-center justify-between gap-3 bg-white px-4 md:px-5 py-3 md:py-4 rounded-2xl border-2 border-slate-100 shadow-sm">
                        <span class="text-xs md:text-sm font-black text-slate-700">ارزش افزوده</span>
                        <label class="switch">
                            <input type="checkbox" id="taxToggle" onchange="renderUI()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <!-- تبدیل واحد - بزرگتر در موبایل -->
                    <div class="flex-1 lg:flex-none flex bg-slate-100 p-1.5 rounded-2xl shadow-inner h-[56px] md:h-[62px] items-center border border-slate-200 min-w-[140px] md:w-44">
                        <button onclick="setCurrency('Toman')" id="btnToman" class="flex-1 h-full rounded-xl text-xs md:text-sm font-black transition-all bg-[var(--primary-green)] text-white shadow-md">تومان</button>
                        <button onclick="setCurrency('Rial')" id="btnRial" class="flex-1 h-full rounded-xl text-xs md:text-sm font-black transition-all text-slate-500">ریال</button>
                    </div>
                </div>

            </div>
        </div>

        <div id="table-container">
            <!-- Loading State -->
            <div class="space-y-6">
                <div class="h-64 w-full bg-white rounded-3xl border border-slate-100 animate-pulse"></div>
            </div>
        </div>
    </main>

    <!-- دکمه شناور تماس -->
    <div id="callBtnContainer" class="call-btn-container fixed bottom-6 left-6 right-6 lg:left-auto lg:right-10 lg:bottom-10 lg:w-80 z-50">
        <a href="tel:02191000000" class="flex items-center gap-4 bg-[var(--dark-green)] text-white p-4 rounded-3xl shadow-2xl border border-white/10 hover:scale-105 transition-transform">
            <div class="w-12 h-12 bg-[var(--primary-green)] rounded-2xl flex items-center justify-center shadow-lg">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
            <div>
                <div class="text-[10px] font-bold opacity-70">تماس جهت ثبت سفارش</div>
                <div class="text-xl font-black tracking-wider">۰۲۱-۹۱۰۰۰۰۰۰</div>
            </div>
        </a>
    </div>

    <script>
        let rawData = null;
        let processedGroups = [];
        let currency = 'Toman';
        
        const urlParams = new URLSearchParams(window.location.search);
        let productFile = urlParams.get('product') || 'تیرآهن';

        const searchInput = document.getElementById('searchInput');
        const callBtnContainer = document.getElementById('callBtnContainer');

        searchInput.addEventListener('focus', () => callBtnContainer.classList.add('call-btn-hidden'));
        searchInput.addEventListener('blur', () => setTimeout(() => callBtnContainer.classList.remove('call-btn-hidden'), 300));

        async function loadJson() {
            const container = document.getElementById('table-container');
            const path = `https://prompthub1.github.io/ahancheck_demo/data/${encodeURIComponent(productFile)}.json`;

            try {
                const response = await fetch(path);
                if (!response.ok) throw new Error();
                rawData = await response.json();
                
                const title = productFile.replace(/-/g, ' ');
                document.getElementById('pageTitle').innerText = 'قیمت لحظه‌ای ' + title;
                processData();
                renderUI();
            } catch (e) {
                container.innerHTML = `<div class="p-20 text-center font-bold text-slate-400">اطلاعاتی یافت نشد.</div>`;
            }
        }

        function processData() {
            if (!rawData) return;
            const headers = rawData.headers;
            const pIdx = headers.findIndex(h => h.includes("قیمت") || h.includes("نرخ"));
            const bIdx = headers.findIndex(h => h.includes("برند") || h.includes("تولید"));

            const groups = {};
            rawData.rows.forEach(row => {
                if (row[0].includes("بروز") || !row[pIdx]) return;
                const brand = (bIdx !== -1 && row[bIdx]) ? row[bIdx] : "برندهای منتخب";
                if (!groups[brand]) groups[brand] = [];
                groups[brand].push({ values: row, price: row[pIdx].toString().replace(/,/g, '') });
            });
            processedGroups = Object.entries(groups).map(([name, items]) => ({ name, headers, items }));
        }

        function setCurrency(c) {
            currency = c;
            document.getElementById('btnToman').className = c === 'Toman' ? 'flex-1 h-full rounded-xl text-xs md:text-sm font-black transition-all bg-[var(--primary-green)] text-white shadow-md' : 'flex-1 h-full rounded-xl text-xs md:text-sm font-black transition-all text-slate-500';
            document.getElementById('btnRial').className = c === 'Rial' ? 'flex-1 h-full rounded-xl text-xs md:text-sm font-black transition-all bg-[var(--primary-green)] text-white shadow-md' : 'flex-1 h-full rounded-xl text-xs md:text-sm font-black transition-all text-slate-500';
            renderUI();
        }

        function formatPrice(raw) {
            let n = parseFloat(raw);
            if (isNaN(n) || n === 0) return "تماس بگیرید";
            if (document.getElementById('taxToggle').checked) n *= 1.1;
            if (currency === 'Rial') n *= 10;
            return Math.round(n).toLocaleString('fa-IR');
        }

        function renderUI() {
            const container = document.getElementById('table-container');
            if (processedGroups.length === 0) return;
            container.innerHTML = '';

            processedGroups.forEach((group, gIdx) => {
                const section = document.createElement('div');
                section.className = 'factory-section';
                section.dataset.name = group.name.toLowerCase();
                
                let rows = '';
                group.items.forEach(item => {
                    const searchData = item.values.join(' ').toLowerCase();
                    rows += `<tr class="table-row hover:bg-white transition-colors" data-search="${searchData}">`;
                    group.headers.forEach((h, i) => {
                        let val = item.values[i] || "-";
                        let cls = "p-4 md:p-5 text-sm md:text-base font-bold text-slate-700 whitespace-nowrap";
                        if (h.includes("قیمت") || h.includes("نرخ")) {
                            val = formatPrice(item.price);
                            cls = "p-4 md:p-5 font-black text-slate-900 bg-slate-50/50 text-left ltr text-lg";
                        }
                        rows += `<td class="${cls}">${val}</td>`;
                    });
                    rows += `</tr>`;
                });

                section.innerHTML = `
                    <div class="p-4 md:p-6 bg-slate-50 flex items-center justify-between border-b border-slate-200">
                        <div class="flex items-center gap-3 md:gap-4">
                            <div class="w-1.5 h-6 md:h-8 bg-[var(--primary-green)] rounded-full"></div>
                            <h2 class="font-black text-base md:text-xl">${group.name}</h2>
                        </div>
                        <div class="flex items-center gap-2 text-[9px] md:text-[10px] font-black text-blue-600 bg-blue-50 px-2 md:px-3 py-1.5 rounded-full border border-blue-100">
                            <span class="relative flex h-2 w-2">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
                            </span>
                            آپدیت امروز
                        </div>
                    </div>
                    
                    <div class="top-scroll-bar custom-scroll-container" id="topScroll-${gIdx}">
                        <div class="top-scroll-content" id="topContent-${gIdx}"></div>
                    </div>

                    <div class="main-table-scroll" id="mainScroll-${gIdx}">
                        <table class="w-full text-right border-collapse">
                            <thead>
                                <tr>${group.headers.map(h => `<th class="p-4 md:p-5 whitespace-nowrap text-xs md:text-sm">${h}</th>`).join('')}</tr>
                            </thead>
                            <tbody>${rows}</tbody>
                        </table>
                    </div>
                `;
                container.appendChild(section);

                setTimeout(() => {
                    const top = document.getElementById(`topScroll-${gIdx}`);
                    const main = document.getElementById(`mainScroll-${gIdx}`);
                    const content = document.getElementById(`topContent-${gIdx}`);
                    
                    if (top && main && content) {
                        if (main.scrollWidth > main.clientWidth) {
                            content.style.width = main.scrollWidth + 'px';
                            top.style.display = 'block';
                        } else {
                            top.style.display = 'none';
                        }
                        
                        top.onscroll = () => main.scrollLeft = top.scrollLeft;
                        main.onscroll = () => top.scrollLeft = main.scrollLeft;
                    }
                }, 100);
            });
        }

        function filterRows() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.factory-section').forEach(sec => {
                let has = false;
                sec.querySelectorAll('.table-row').forEach(row => {
                    const match = row.dataset.search.includes(q) || sec.dataset.name.includes(q);
                    row.style.display = match ? '' : 'none';
                    if (match) has = true;
                });
                sec.style.display = has ? '' : 'none';
            });
        }

        window.onload = loadJson;
    </script>
</body>
</html>
